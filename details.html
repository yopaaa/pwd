<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>NeoPrice</title>
    <link rel="icon" type="image/png" href="/assets/logo.jpeg">
</head>

<body>
    <header>
        <h1>Selamat Datang di NeoPrice</h1>
        <nav>
            <ul>
                <li><a href="/#">Home</a></li>
                <li><a href="/#news">Berita</a></li>
                <li><a href="/#prices">Harga</a></li>
                <li><a href="/#about">Tentang</a></li>
                <li><a href="/#services">Visi/Misi</a></li>
                <li><a href="/#contact">Kontak</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <h1 id="chartTitle">Grafik Harga Komoditas</h1>
        <div class="about-container" id="about" style="padding: 20px;">
            <div class="about-image" style="height: 400px;">
                <canvas id="grafikCanvas"></canvas>

            </div>
            <div class="about-description" id="chartDescription">
                <h2>Tentang NeoPrice</h2>
                <p id="chartDescription">NeoPrice menyediakan indeks harga komoditas terkini dan tren pasar untuk
                    membantu Anda mengambil
                    keputusan yang terinformasi.</p>
            </div>

            <script>
                let selectedData = null
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id');

                function showDetails(data) {
                    document.getElementById('chartTitle').innerHTML = `Grafik Harga ${data.name}`;
                    document.getElementById('chartDescription').innerHTML = `
<h3>Detail Komoditas ${data.name}</h3>
<div style="display: flex; flex-direction: row; gap: 10px;">
<ul>
  <li>Nama: ${data.name}</li>
  <li>Satuan: ${data.satuan}</li>
  <li>Harga Hari Ini: Rp ${data.today}</li>
  <li>Harga Kemarin: Rp ${data.yesterday}</li>
  <li>Tanggal Harga Kemarin: ${data.yesterday_date}</li>
  <li>Selisih (Gap): ${data.gap}</li>
  <li>Persentase Selisih: ${data.gap_percentage}</li>
  <li>Arah Perubahan: ${data.gap_change}</li>
  <li>Warna Perubahan: ${data.gap_color}</li>
</ul>

<div class="detail-card" style="max-width:400px;background:#fff;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.08);overflow:hidden;font-family:sans-serif">
  <div style="background:#f9fafb;padding:12px;display:flex;align-items:center;gap:12px">
    <img src="${data.background}" alt="Ikon ${data.name}" style="width:48px;height:48px;object-fit:contain" />
    <h2 style="margin:0;font-size:18px">${data.name}</h2>
  </div>
  <div style="padding:16px">
    <p style="margin:0 0 8px 0;font-size:14px;color:#555">Satuan: ${data.satuan}</p>
    <div style="display:flex;align-items:center;gap:12px">
      <span style="font-size:20px;font-weight:700">Rp ${data.today}</span>
      <span style="font-size:14px;color:${data.gap_color}">▲ ${data.gap} (${data.gap_percentage}%)</span>
    </div>
    <p style="margin:8px 0 0 0;font-size:13px;color:#777">Kemarin (${data.yesterday_date}): Rp ${data.yesterday}</p>
  </div>
</div>
</div>


                    `;
                    showChart({
                        label: data.name,
                        yesterday: data.yesterday,
                        today: data.today,
                        labels: Array.from({ length: 50 }, (_, i) => `Minggu ${i + 1}`),
                    });
                }

                function generateChartData(today, yesterday, length = 50) {
                    const start = Math.floor(today * 0.3); // mulai dari 30% harga today
                    const arr = [];
                    const step = (today - start) / (length - 1); // tren menuju today
                    let current = start;

                    for (let i = 0; i < length; i++) {
                        const noise = Math.floor((Math.random() - 0.5) * step * 2);
                        const value = Math.round(current + noise);
                        arr.push(value);

                        current = start + step * (i + 1);
                    }

                    arr[0] = start;
                    arr[length - 2] = yesterday; // posisi ke-49 = yesterday
                    arr[length - 1] = today;     // posisi ke-50 = today

                    return arr;
                }

                function showChart(params) {
                    let data = generateChartData(params.yesterday, params.today, 50);
                    const ctx = document.getElementById('grafikCanvas').getContext('2d');
                    const grafikChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: params.labels,
                            datasets: [{
                                label: params.label,
                                data: data,
                                borderColor: "blue",
                                backgroundColor: "rgba(0, 0, 255, 0.2)",
                                fill: true,
                                tension: 0.3 // bikin garis agak melengkung
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });

                }

            </script>
        </div>

        <section id="prices">
            <h1>Harga Pangan Informasi (Level Produsen)</h1>
            <div class="price-container" id="cards-container"> </div>

            <div class="prices-nav" style="justify-content: center;">
                <a href="/#prices">Lihat Lebih Banyak</a>
            </div>

            <script>
                const API_URL = "https://api-panelhargav2.badanpangan.go.id/api/front/harga-pangan-informasi?province_id=&city_id=&level_harga_id=1";

                function formatNumber(num) {
                    return num.toLocaleString("id-ID");
                }

                function createCard(item) {
                    // Gap icon: panah ke atas/bawah
                    const gapIcon = item.gap_change === "up" ? "▲" : "▼";

                    const card = document.createElement("div");
                    card.className = "price-card";

                    card.innerHTML = `
                    <a href="/details.html?id=${item.id}" class="normalAnchor">
        <div class="price-card-header" style="background-image: url('${item.background}')"></div>
        <div class="price-card-body">
          <div class="price-name">${item.name}</div>
          <div class="price-price">${formatNumber(item.today)} <span class="price-unit">${item.satuan}</span></div>
          <div class="price-info-row">
            <div>Kemarin (${item.yesterday_date}): ${formatNumber(item.yesterday)}</div>
            <div class="price-gap ${item.gap_change}">
              ${item.gap > 0 ? "+" : ""}${formatNumber(item.gap)} (${item.gap_percentage.toFixed(2)}%)
              <span class="price-gap-icon">${gapIcon}</span>
            </div>
          </div>
        </div>
        </a>
      `;

                    return card;
                }

                async function loadData() {
                    try {
                        const response = await fetch(API_URL);
                        if (!response.ok) throw new Error("Gagal mengambil data");

                        const result = await response.json();

                        selectedData = result.data.find(d => d.id === parseInt(id));
                        showDetails(selectedData);


                        if (result.status === "success" && Array.isArray(result.data)) {
                            const container = document.getElementById("cards-container");
                            container.innerHTML = ""; // clear first

                            result.data.slice(0, 4).forEach(item => {
                                const card = createCard(item);
                                container.appendChild(card);
                            });
                        } else {
                            console.error("Data tidak valid", result);
                            document.getElementById("cards-container").innerText = "Data tidak tersedia.";
                        }
                    } catch (error) {
                        console.error("Error fetching data:", error);
                        document.getElementById("cards-container").innerText = "Terjadi kesalahan saat mengambil data.";
                    }
                }

                loadData();
            </script>

        </section>

        <section>
            <table border="1" cellspacing="0" cellpadding="6">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Komoditas</th>
                        <th>Wilayah</th>
                        <th>Harga Hari Ini</th>
                        <th>Harga Kemarin</th>
                        <th>Satuan</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Data dari JSON akan ditambahkan di sini -->
                </tbody>
            </table>

            <script>
                fetch("/data/produsen.json")
                    .then(res => res.json())
                    .then(data => {
                        const tbody = document.getElementById("table-body");
                        tbody.innerHTML = ""; // kosongkan dulu

                        data.forEach((item, index) => {
                            const tr = document.createElement("tr");

                            tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${item.komoditas}</td>
          <td>${item.wilayah}</td>
          <td>${item.harga_today}</td>
          <td>${item.harga_yesterday}</td>
          <td>${item.satuan}</td>
        `;

                            tbody.appendChild(tr);
                        });
                    })
                    .catch(err => console.error("Gagal ambil data:", err));
            </script>



        </section>
    </div>



    <footer>
        <div class="footer-container">
            <div class="footer-container-left">
                <img src="/assets/logo.jpeg" alt="Logo" style="width: 100px;">
                <h3>Tentang NeoPrice</h3>
                <p>NeoPrice menyediakan indeks harga komoditas terkini dan tren pasar untuk membantu Anda mengambil
                    keputusan yang terinformasi.</p>
            </div>

            <div class="footer-container-right">
                <span>
                    <h3>Halaman</h3>
                    <div class="footer-content-list">
                        <a href="#">Home</a>
                        <a href="#news">Berita</a>
                        <a href="#prices">Harga</a>
                        <a href="#about">Tentang</a>
                        <a href="#services">Visi/Misi</a>
                        <a href="#">Kontak</a>
                    </div>
                </span>

                <span>
                    <h3>Berita</h3>
                    <div class="footer-content-list footer-news-list"> </div>

                    <script>
                        async function loadArticles() {
                            const container = document.querySelector('.footer-news-list');
                            container.innerHTML = "";

                            try {
                                const response = await fetch("https://api-panelhargav2.badanpangan.go.id/api/cms/articles?type=1&page=1");
                                const result = await response.json();

                                if (result.status === "success" && result.data.length > 0) {
                                    result.data.slice(0, 4).forEach(article => {
                                        const sourceUrlMatch = article.description.match(/Sumber\s*:\s*(https?:\/\/[^\s<]+)/);
                                        const sourceUrl = sourceUrlMatch ? sourceUrlMatch[1] : "#";
                                        container.innerHTML += `<a href="${sourceUrl}" target="_blank">${article.title}</a>`;
                                    });
                                } else {
                                    container.innerHTML = "<p>Tidak ada berita ditemukan.</p>";
                                }

                            } catch (error) {
                                container.innerHTML = "<p>Gagal memuat berita. Silakan coba lagi nanti.</p>";
                                console.error("Fetch error:", error);
                            }
                        }

                        loadArticles();
                    </script>
                </span>

                <span>
                    <h3>Kontak Kami</h3>
                    <div class="footer-content-list">
                        <a href="mailto:support@neoprice.com">Email: support@neoprice.com</a>
                        <a href="tel:08123456789">Telepon: 08123456789</a>
                    </div>
                </span>
            </div>
        </div>
        <p>&copy; 2025 NeoPrice. All rights reserved.</p>
    </footer>
</body>

</html>