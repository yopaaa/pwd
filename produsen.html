<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <title>NeoPrice</title>
    <link rel="icon" type="image/png" href="/assets/logo.jpeg">
</head>

<body>
    <header>
        <h1>Selamat Datang di NeoPrice</h1>
        <nav>
            <ul>
                <li><a href="/#">Home</a></li>
                <li><a href="/#news">Berita</a></li>
                <li><a href="/#prices">Harga</a></li>
                <li><a href="/#about">Tentang</a></li>
                <li><a href="/#services">Visi/Misi</a></li>
                <li><a href="/#contact">Kontak</a></li>
                <li><a href="/produsen.html">Produsen</a></li>

            </ul>
        </nav>
    </header>

    <div class="container">
        <h1 id="chartTitle">Grafik Harga Komoditas</h1>

        <section>
            <table border="1" cellspacing="0" cellpadding="6">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Komoditas</th>
                        <th>Wilayah</th>
                        <th>Harga Hari Ini</th>
                        <th>Harga Kemarin</th>
                        <th>Satuan</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Data dari JSON akan ditambahkan di sini -->
                </tbody>
            </table>

            <script>
                fetch("/data/produsen.json")
                    .then(res => res.json())
                    .then(data => {
                        const tbody = document.getElementById("table-body");
                        tbody.innerHTML = ""; // kosongkan dulu

                        data.forEach((item, index) => {
                            const tr = document.createElement("tr");

                            tr.innerHTML = `
          <td>${index + 1}</td>
          <td>${item.komoditas}</td>
          <td>${item.wilayah}</td>
          <td>${item.harga_today}</td>
          <td>${item.harga_yesterday}</td>
          <td>${item.satuan}</td>
        `;

                            tbody.appendChild(tr);
                        });
                    })
                    .catch(err => console.error("Gagal ambil data:", err));
            </script>



        </section>


        <section id="prices">
            <h1>Harga Pangan Informasi (Level Produsen)</h1>
            <div class="price-container" id="cards-container"> </div>

            <div class="prices-nav" style="justify-content: center;">
                <a href="/#prices">Lihat Lebih Banyak</a>
            </div>

            <script>
                const API_URL = "https://api-panelhargav2.badanpangan.go.id/api/front/harga-pangan-informasi?province_id=&city_id=&level_harga_id=1";

                function formatNumber(num) {
                    return num.toLocaleString("id-ID");
                }

                function createCard(item) {
                    // Gap icon: panah ke atas/bawah
                    const gapIcon = item.gap_change === "up" ? "▲" : "▼";

                    const card = document.createElement("div");
                    card.className = "price-card";

                    card.innerHTML = `
                    <a href="/details.html?id=${item.id}" class="normalAnchor">
        <div class="price-card-header" style="background-image: url('${item.background}')"></div>
        <div class="price-card-body">
          <div class="price-name">${item.name}</div>
          <div class="price-price">${formatNumber(item.today)} <span class="price-unit">${item.satuan}</span></div>
          <div class="price-info-row">
            <div>Kemarin (${item.yesterday_date}): ${formatNumber(item.yesterday)}</div>
            <div class="price-gap ${item.gap_change}">
              ${item.gap > 0 ? "+" : ""}${formatNumber(item.gap)} (${item.gap_percentage.toFixed(2)}%)
              <span class="price-gap-icon">${gapIcon}</span>
            </div>
          </div>
        </div>
        </a>
      `;

                    return card;
                }

                async function loadData() {
                    try {
                        const response = await fetch(API_URL);
                        if (!response.ok) throw new Error("Gagal mengambil data");

                        const result = await response.json();


                        if (result.status === "success" && Array.isArray(result.data)) {
                            const container = document.getElementById("cards-container");
                            container.innerHTML = ""; // clear first

                            result.data.slice(0, 4).forEach(item => {
                                const card = createCard(item);
                                container.appendChild(card);
                            });
                        } else {
                            console.error("Data tidak valid", result);
                            document.getElementById("cards-container").innerText = "Data tidak tersedia.";
                        }
                    } catch (error) {
                        console.error("Error fetching data:", error);
                        document.getElementById("cards-container").innerText = "Terjadi kesalahan saat mengambil data.";
                    }
                }

                loadData();
            </script>

        </section>
    </div>



    <footer>
        <div class="footer-container">
            <div class="footer-container-left">
                <img src="/assets/logo.jpeg" alt="Logo" style="width: 100px;">
                <h3>Tentang NeoPrice</h3>
                <p>NeoPrice menyediakan indeks harga komoditas terkini dan tren pasar untuk membantu Anda mengambil
                    keputusan yang terinformasi.</p>
            </div>

            <div class="footer-container-right">
                <span>
                    <h3>Halaman</h3>
                    <div class="footer-content-list">
                        <a href="#">Home</a>
                        <a href="#news">Berita</a>
                        <a href="#prices">Harga</a>
                        <a href="#about">Tentang</a>
                        <a href="#services">Visi/Misi</a>
                        <a href="#">Kontak</a>
                    </div>
                </span>

                <span>
                    <h3>Berita</h3>
                    <div class="footer-content-list footer-news-list"> </div>

                    <script>
                        async function loadArticles() {
                            const container = document.querySelector('.footer-news-list');
                            container.innerHTML = "";

                            try {
                                const response = await fetch("https://api-panelhargav2.badanpangan.go.id/api/cms/articles?type=1&page=1");
                                const result = await response.json();

                                if (result.status === "success" && result.data.length > 0) {
                                    result.data.slice(0, 4).forEach(article => {
                                        const sourceUrlMatch = article.description.match(/Sumber\s*:\s*(https?:\/\/[^\s<]+)/);
                                        const sourceUrl = sourceUrlMatch ? sourceUrlMatch[1] : "#";
                                        container.innerHTML += `<a href="${sourceUrl}" target="_blank">${article.title}</a>`;
                                    });
                                } else {
                                    container.innerHTML = "<p>Tidak ada berita ditemukan.</p>";
                                }

                            } catch (error) {
                                container.innerHTML = "<p>Gagal memuat berita. Silakan coba lagi nanti.</p>";
                                console.error("Fetch error:", error);
                            }
                        }

                        loadArticles();
                    </script>
                </span>

                <span>
                    <h3>Kontak Kami</h3>
                    <div class="footer-content-list">
                        <a href="mailto:support@neoprice.com">Email: support@neoprice.com</a>
                        <a href="tel:08123456789">Telepon: 08123456789</a>
                    </div>
                </span>
            </div>
        </div>
        <p>&copy; 2025 NeoPrice. All rights reserved.</p>
    </footer>
</body>

</html>